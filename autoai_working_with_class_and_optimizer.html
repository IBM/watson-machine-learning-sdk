<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Working with AutoAI class and optimizer &#8212; ibm-watson-machine-learning(V4) 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystyle2.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Working with DataConnection" href="autoai_working_with_dataconnection.html" />
    <link rel="prev" title="AutoAI" href="autoai.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/wml_logo2.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">IBM Watson Machine Learning</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="api.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="api.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="api.html#modules">Modules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="core_api.html">Core</a></li>
<li class="toctree-l3"><a class="reference internal" href="federated_learning.html">Federated Learning</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="autoai.html">AutoAI</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Working with AutoAI class and optimizer</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#configure-optimizer-with-one-data-source">Configure optimizer with one data source</a></li>
<li class="toctree-l5"><a class="reference internal" href="#configure-optimizer-with-joined-data-ibm-cloud-pak-for-data-only">Configure optimizer with joined data (IBM Cloud Pak for Data only)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#configure-optimizer-for-time-series-forecasting">Configure optimizer for time series forecasting</a></li>
<li class="toctree-l5"><a class="reference internal" href="#configure-optimizer-for-time-series-forecasting-with-supporting-features">Configure optimizer for time series forecasting with supporting features</a></li>
<li class="toctree-l5"><a class="reference internal" href="#get-configuration-parameters">Get configuration parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="#fit-optimizer">Fit optimizer</a></li>
<li class="toctree-l5"><a class="reference internal" href="#get-run-status-get-run-details">Get run status, get run details</a></li>
<li class="toctree-l5"><a class="reference internal" href="#get-data-connections">Get data connections</a></li>
<li class="toctree-l5"><a class="reference internal" href="#get-preprocessed-data-connection-joined-data-only">Get preprocessed data connection (joined data only)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l5"><a class="reference internal" href="#get-pipeline-details">Get pipeline details</a></li>
<li class="toctree-l5"><a class="reference internal" href="#get-pipeline">Get pipeline</a></li>
<li class="toctree-l5"><a class="reference internal" href="#working-with-deployments">Working with deployments</a></li>
<li class="toctree-l5"><a class="reference internal" href="#web-service">Web Service</a></li>
<li class="toctree-l5"><a class="reference internal" href="#batch">Batch</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="autoai_working_with_dataconnection.html">Working with DataConnection</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoai_experiment.html">AutoAI experiment</a></li>
<li class="toctree-l4"><a class="reference internal" href="dataconnection_modules.html">DataConnection Modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoai_deployment_modules.html">Deployment Modules for AutoAI models</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="samples.html">Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="working-with-autoai-class-and-optimizer">
<h1>Working with AutoAI class and optimizer<a class="headerlink" href="#working-with-autoai-class-and-optimizer" title="Permalink to this heading">¶</a></h1>
<p>The <a class="reference internal" href="autoai_experiment.html#autoai-class"><span class="std std-ref">AutoAI experiment class</span></a> is responsible for creating experiments and scheduling training.
All experiment results are stored automatically in the user-specified Cloud Object Storage (COS).
Then, the AutoAI feature can fetch the results and provide them directly to the user for further usage.</p>
<section id="configure-optimizer-with-one-data-source">
<h2>Configure optimizer with one data source<a class="headerlink" href="#configure-optimizer-with-one-data-source" title="Permalink to this heading">¶</a></h2>
<p>For an AutoAI object initialization WML credentials (with apikey and url) and one of <code class="docutils literal notranslate"><span class="pre">project_id</span></code> or <code class="docutils literal notranslate"><span class="pre">space_id</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ibm_watson_machine_learning.experiment</span> <span class="kn">import</span> <span class="n">AutoAI</span>

<span class="n">experiment</span> <span class="o">=</span> <span class="n">AutoAI</span><span class="p">(</span><span class="n">wml_credentials</span><span class="p">,</span>
    <span class="n">space_id</span><span class="o">=</span><span class="s1">&#39;76g53e0-0b32-4a0e-9152-3d50324855ddb&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">pipeline_optimizer</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">optimizer</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;test name&#39;</span><span class="p">,</span>
            <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;test description&#39;</span><span class="p">,</span>
            <span class="n">prediction_type</span><span class="o">=</span><span class="n">AutoAI</span><span class="o">.</span><span class="n">PredictionType</span><span class="o">.</span><span class="n">BINARY</span><span class="p">,</span>
            <span class="n">prediction_column</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
            <span class="n">scoring</span><span class="o">=</span><span class="n">AutoAI</span><span class="o">.</span><span class="n">Metrics</span><span class="o">.</span><span class="n">ACCURACY_SCORE</span><span class="p">,</span>
            <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">max_num_daub_ensembles</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">train_sample_rows_test_size</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
            <span class="n">daub_include_only_estimators</span> <span class="o">=</span> <span class="p">[</span>
                 <span class="n">AutoAI</span><span class="o">.</span><span class="n">ClassificationAlgorithms</span><span class="o">.</span><span class="n">XGB</span><span class="p">,</span>
                 <span class="n">AutoAI</span><span class="o">.</span><span class="n">ClassificationAlgorithms</span><span class="o">.</span><span class="n">LGBM</span>
                 <span class="p">],</span>
            <span class="n">cognito_transform_names</span> <span class="o">=</span> <span class="p">[</span>
                 <span class="n">AutoAI</span><span class="o">.</span><span class="n">Transformers</span><span class="o">.</span><span class="n">SUM</span><span class="p">,</span>
                 <span class="n">AutoAI</span><span class="o">.</span><span class="n">Transformers</span><span class="o">.</span><span class="n">MAX</span>
                 <span class="p">]</span>
        <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="configure-optimizer-with-joined-data-ibm-cloud-pak-for-data-only">
<h2>Configure optimizer with joined data (IBM Cloud Pak for Data only)<a class="headerlink" href="#configure-optimizer-with-joined-data-ibm-cloud-pak-for-data-only" title="Permalink to this heading">¶</a></h2>
<p><strong>Warning!</strong> Not supported for IBM Cloud.</p>
<p>AutoAI allows you to combine data from multiple data sources into a single data source input for the experiment.</p>
<p><strong>Important</strong>: The AutoAI feature for joining multiple data sources into a single training data set
is not supported in Cloud Pak for Data 4.6 release and later.</p>
<p>To define a join graph, define all data connections with an additional parameter: <code class="docutils literal notranslate"><span class="pre">data_join_node_name</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">main_conn</span> <span class="o">=</span> <span class="n">DataConnection</span><span class="p">(</span>
    <span class="n">data_join_node_name</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="n">FSLocation</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">data_cos_path</span> <span class="o">+</span> <span class="s1">&#39;group_customer_main.csv&#39;</span><span class="p">))</span>

<span class="n">customers_transactions_conn</span> <span class="o">=</span> <span class="n">DataConnection</span><span class="p">(</span>
    <span class="n">data_join_node_name</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;customers&quot;</span><span class="p">,</span> <span class="s2">&quot;transactions&quot;</span><span class="p">],</span>
    <span class="n">location</span><span class="o">=</span><span class="n">FSLocation</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">data_cos_path</span> <span class="o">+</span> <span class="s1">&#39;group_customer.xlsx&#39;</span><span class="p">))</span>

<span class="n">customers_conn</span> <span class="o">=</span> <span class="n">DataConnection</span><span class="p">(</span>
    <span class="n">data_join_node_name</span><span class="o">=</span><span class="s2">&quot;customers&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="n">FSLocation</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">data_cos_path</span> <span class="o">+</span> <span class="s1">&#39;group_customer_customers.csv&#39;</span><span class="p">))</span>

<span class="n">transactions_conn</span> <span class="o">=</span> <span class="n">DataConnection</span><span class="p">(</span>
    <span class="n">data_join_node_name</span><span class="o">=</span><span class="s2">&quot;transactions&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="n">FSLocation</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">data_cos_path</span> <span class="o">+</span> <span class="s1">&#39;group_customer_transactions.csv&#39;</span><span class="p">))</span>

<span class="n">purchases_conn</span> <span class="o">=</span> <span class="n">DataConnection</span><span class="p">(</span>
    <span class="n">data_join_node_name</span><span class="o">=</span><span class="s2">&quot;purchases&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="n">FSLocation</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">data_cos_path</span> <span class="o">+</span> <span class="s1">&#39;group_customer_purchase.csv&#39;</span><span class="p">))</span>

<span class="n">products_conn</span> <span class="o">=</span> <span class="n">DataConnection</span><span class="p">(</span>
    <span class="n">data_join_node_name</span><span class="o">=</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="n">FSLocation</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">data_cos_path</span> <span class="o">+</span> <span class="s1">&#39;group_customer_products.csv&#39;</span><span class="p">))</span>

<span class="n">results_connection</span> <span class="o">=</span> <span class="n">DataConnection</span><span class="p">(</span>
    <span class="n">location</span><span class="o">=</span><span class="n">FSLocation</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">results_cos_path</span><span class="p">))</span>

<span class="n">data_connections</span> <span class="o">=</span> <span class="p">[</span><span class="n">main_conn</span><span class="p">,</span>
                    <span class="n">customers_transactions_conn</span><span class="p">,</span>
                    <span class="n">purchases_conn</span><span class="p">,</span>
                    <span class="n">products_conn</span><span class="p">]</span>
</pre></div>
</div>
<p>Next step is to create a join graph object (instance of the DataJoinGraph class). When you create the object, you can add additional parameters for specific files that contain data. For example, <code class="docutils literal notranslate"><span class="pre">csv_separator</span></code> for csv, or <code class="docutils literal notranslate"><span class="pre">sheet_name</span></code> for xlsx.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">data_join_node_name</span></code>, you can first define graph nodes and then graph edges.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_join_graph</span> <span class="o">=</span> <span class="n">DataJoinGraph</span><span class="p">()</span>
<span class="n">data_join_graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">csv_separator</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<span class="n">data_join_graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;customers&quot;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;customers&quot;</span><span class="p">)</span>
<span class="n">data_join_graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;transactions&quot;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;transactions&quot;</span><span class="p">)</span>
<span class="n">data_join_graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;purchases&quot;</span><span class="p">)</span>
<span class="n">data_join_graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;products&quot;</span><span class="p">)</span>
<span class="n">data_join_graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">from_node</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">to_node</span><span class="o">=</span><span class="s2">&quot;customers&quot;</span><span class="p">,</span>
                     <span class="n">from_column</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;group_customer_id&quot;</span><span class="p">],</span> <span class="n">to_column</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;group_customer_id&quot;</span><span class="p">])</span>
<span class="n">data_join_graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">from_node</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">to_node</span><span class="o">=</span><span class="s2">&quot;transactions&quot;</span><span class="p">,</span>
                     <span class="n">from_column</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;transaction_id&quot;</span><span class="p">],</span> <span class="n">to_column</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;transaction_id&quot;</span><span class="p">])</span>
<span class="n">data_join_graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">from_node</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">to_node</span><span class="o">=</span><span class="s2">&quot;purchases&quot;</span><span class="p">,</span>
                     <span class="n">from_column</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;group_id&quot;</span><span class="p">],</span> <span class="n">to_column</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;group_id&quot;</span><span class="p">])</span>
<span class="n">data_join_graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">from_node</span><span class="o">=</span><span class="s2">&quot;transactions&quot;</span><span class="p">,</span> <span class="n">to_node</span><span class="o">=</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
                     <span class="n">from_column</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;product_id&quot;</span><span class="p">],</span> <span class="n">to_column</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;product_id&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>You can now use your join graph in the optimizer configuration step.</p>
<p>In a multi-data source scenario, a join graph is passed as a parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span> <span class="o">=</span> <span class="n">AutoAI</span><span class="p">(</span><span class="n">wml_credentials</span><span class="p">,</span>
    <span class="n">space_id</span><span class="o">=</span><span class="s1">&#39;76g53e0-0b32-4a0e-9152-3d50324855ddb&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">pipeline_optimizer</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">optimizer</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;obm scenario&#39;</span><span class="p">,</span>
    <span class="n">prediction_type</span><span class="o">=</span><span class="n">AutoAI</span><span class="o">.</span><span class="n">PredictionType</span><span class="o">.</span><span class="n">REGRESSION</span><span class="p">,</span>
    <span class="n">prediction_column</span><span class="o">=</span><span class="s1">&#39;next_purchase&#39;</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">AutoAI</span><span class="o">.</span><span class="n">Metrics</span><span class="o">.</span><span class="n">LOG_LOSS</span><span class="p">,</span>
    <span class="n">max_number_of_estimators</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">daub_include_only_estimators</span><span class="o">=</span><span class="p">[</span><span class="n">experiment</span><span class="o">.</span><span class="n">RegressionAlgorithms</span><span class="o">.</span><span class="n">LGBM</span><span class="p">],</span>
    <span class="n">data_join_graph</span><span class="o">=</span><span class="n">data_join_graph</span><span class="p">,</span>
    <span class="n">t_shirt_size</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">TShirtSize</span><span class="o">.</span><span class="n">L</span><span class="p">,</span>
    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="configure-optimizer-for-time-series-forecasting">
<h2>Configure optimizer for time series forecasting<a class="headerlink" href="#configure-optimizer-for-time-series-forecasting" title="Permalink to this heading">¶</a></h2>
<p><strong>Note:</strong> Supported for IBM Cloud Pak for Data 4.0 and higher.</p>
<p>Time series forecasting is a special AutoAI prediction scenario, with specific parameters used to configure forecasting:
<code class="docutils literal notranslate"><span class="pre">prediction_columns</span></code>, <code class="docutils literal notranslate"><span class="pre">timestamp_column_name</span></code>, <code class="docutils literal notranslate"><span class="pre">backtest_num</span></code>, <code class="docutils literal notranslate"><span class="pre">lookback_window</span></code>, <code class="docutils literal notranslate"><span class="pre">forecast_window</span></code>, <code class="docutils literal notranslate"><span class="pre">backtest_gap_length</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ibm_watson_machine_learning.experiment</span> <span class="kn">import</span> <span class="n">AutoAI</span>

<span class="n">experiment</span> <span class="o">=</span> <span class="n">AutoAI</span><span class="p">(</span><span class="n">wml_credentials</span><span class="p">,</span>
    <span class="n">space_id</span><span class="o">=</span><span class="s1">&#39;76g53e0-0b32-4a0e-9152-3d50324855ddb&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">pipeline_optimizer</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">optimizer</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;forecasting optimiser&#39;</span><span class="p">,</span>
    <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;description&#39;</span><span class="p">,</span>
    <span class="n">prediction_type</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">PredictionType</span><span class="o">.</span><span class="n">FORECASTING</span><span class="p">,</span>
    <span class="n">prediction_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
    <span class="n">timestamp_column_name</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span>
    <span class="n">backtest_num</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">lookback_window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">forecast_window</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">holdout_size</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">max_number_of_estimators</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">include_only_estimators</span><span class="o">=</span><span class="p">[</span><span class="n">AutoAI</span><span class="o">.</span><span class="n">ForecastingAlgorithms</span><span class="o">.</span><span class="n">ENSEMBLER</span><span class="p">],</span>
    <span class="n">t_shirt_size</span><span class="o">=</span><span class="n">TShirtSize</span><span class="o">.</span><span class="n">L</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Optimizer and deployment fitting procedures are the same as in the basic scenario.</p>
</section>
<section id="configure-optimizer-for-time-series-forecasting-with-supporting-features">
<h2>Configure optimizer for time series forecasting with supporting features<a class="headerlink" href="#configure-optimizer-for-time-series-forecasting-with-supporting-features" title="Permalink to this heading">¶</a></h2>
<p><strong>Note</strong> Supported for IBM Cloud and IBM Cloud Pak for Data version 4.5 and higher.</p>
<p>Additional parameters can be passed to run time series forecasting scenarios with supporting features:
<code class="docutils literal notranslate"><span class="pre">feature_columns</span></code>, <code class="docutils literal notranslate"><span class="pre">pipeline_types</span></code>, <code class="docutils literal notranslate"><span class="pre">supporting_features_at_forecast</span></code></p>
<p>For more information about supporting features refer to <a class="reference external" href="https://dataplatform.cloud.ibm.com/docs/content/wsj/analyze-data/autoai-timeseries.html?context=cpdaas&amp;audience=wdp">time series documentation</a> .</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ibm_watson_machine_learning.experiment</span> <span class="kn">import</span> <span class="n">AutoAI</span>
<span class="kn">from</span> <span class="nn">ibm_watson_machine_learning.utils.autoai.enums</span> <span class="kn">import</span> <span class="n">ForecastingPipelineTypes</span>

<span class="n">experiment</span> <span class="o">=</span> <span class="n">AutoAI</span><span class="p">(</span><span class="n">wml_credentials</span><span class="p">,</span>
    <span class="n">space_id</span><span class="o">=</span><span class="s1">&#39;76g53e0-0b32-4a0e-9152-3d50324855ddb&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">pipeline_optimizer</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">optimizer</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;forecasting optimizer&#39;</span><span class="p">,</span>
    <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;description&#39;</span><span class="p">,</span>
    <span class="n">prediction_type</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">PredictionType</span><span class="o">.</span><span class="n">FORECASTING</span><span class="p">,</span>
    <span class="n">prediction_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
    <span class="n">timestamp_column_name</span><span class="o">=</span><span class="s1">&#39;week&#39;</span><span class="p">,</span>
    <span class="n">feature_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span>
    <span class="n">pipeline_types</span><span class="o">=</span><span class="p">[</span><span class="n">ForecastingPipelineTypes</span><span class="o">.</span><span class="n">FlattenEnsembler</span><span class="p">]</span> <span class="o">+</span> <span class="n">ForecastingPipelineTypes</span><span class="o">.</span><span class="n">get_exogenous</span><span class="p">(),</span>
    <span class="n">supporting_features_at_forecast</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Predicting for time series forecasting scenario with supporting features:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example data:</span>
<span class="c1">#   new_observations:</span>
<span class="c1">#       week       a   b  value</span>
<span class="c1">#       14.0       0   0  134</span>
<span class="c1">#       15.0       1   4  96</span>
<span class="c1">#       ...</span>
<span class="c1">#</span>
<span class="c1">#   supporting_features:</span>
<span class="c1">#       week       a   b</span>
<span class="c1">#       16.0       1   3</span>
<span class="c1">#       ...</span>

<span class="c1"># with DataFrame or np.array:</span>
<span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">new_observations</span><span class="p">,</span> <span class="n">supporting_features</span><span class="o">=</span><span class="n">supporting_features</span><span class="p">)</span>
</pre></div>
</div>
<p>Online scoring for time series forecasting scenario with supporting features:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># with DataFrame:</span>
<span class="n">web_service</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;observations&#39;</span><span class="p">:</span> <span class="n">new_observations_df</span><span class="p">,</span> <span class="s1">&#39;supporting_features&#39;</span><span class="p">:</span> <span class="n">supporting_features_df</span><span class="p">})</span>
</pre></div>
</div>
<p>Batch scoring for time series forecasting scenario with supporting features:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># with DataFrame:</span>
<span class="n">batch_service</span><span class="o">.</span><span class="n">run_job</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;observations&#39;</span><span class="p">:</span> <span class="n">new_observations_df</span><span class="p">,</span> <span class="s1">&#39;supporting_features&#39;</span><span class="p">:</span> <span class="n">supporting_features_df</span><span class="p">})</span>

<span class="c1"># with DataConnection:</span>
<span class="n">batch_service</span><span class="o">.</span><span class="n">run_job</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;observations&#39;</span><span class="p">:</span> <span class="n">new_observations_data_connection</span><span class="p">,</span> <span class="s1">&#39;supporting_features&#39;</span><span class="p">:</span> <span class="n">supporting_features_data_connection</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="get-configuration-parameters">
<h2>Get configuration parameters<a class="headerlink" href="#get-configuration-parameters" title="Permalink to this heading">¶</a></h2>
<p>To see current configuration parameters, call the <code class="docutils literal notranslate"><span class="pre">get_params()</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">config_parameters</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">config_parameters</span><span class="p">)</span>
<span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test name&#39;</span><span class="p">,</span>
    <span class="s1">&#39;desc&#39;</span><span class="p">:</span> <span class="s1">&#39;test description&#39;</span><span class="p">,</span>
    <span class="s1">&#39;prediction_type&#39;</span><span class="p">:</span> <span class="s1">&#39;classification&#39;</span><span class="p">,</span>
    <span class="s1">&#39;prediction_column&#39;</span><span class="p">:</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span>
    <span class="s1">&#39;scoring&#39;</span><span class="p">:</span> <span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;test_size&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="s1">&#39;max_num_daub_ensembles&#39;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="fit-optimizer">
<h2>Fit optimizer<a class="headerlink" href="#fit-optimizer" title="Permalink to this heading">¶</a></h2>
<p>To schedule an AutoAI experiment, call the <code class="docutils literal notranslate"><span class="pre">fit()</span></code> method. This will trigger a training and an optimization process on WML. The <code class="docutils literal notranslate"><span class="pre">fit()</span></code> method can be synchronous (<code class="docutils literal notranslate"><span class="pre">background_mode=False</span></code>), or asynchronous (<code class="docutils literal notranslate"><span class="pre">background_mode=True</span></code>).
If you don’t want to wait for fit to end, invoke the async version. It immediately returns only fit/run details.
If you invoke the async version, you see a progress bar with information about the learning/optimization process.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit_details</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">training_data_references</span><span class="o">=</span><span class="p">[</span><span class="n">training_data_connection</span><span class="p">],</span>
        <span class="n">training_results_reference</span><span class="o">=</span><span class="n">results_connection</span><span class="p">,</span>
        <span class="n">background_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># OR</span>

<span class="n">fit_details</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">training_data_references</span><span class="o">=</span><span class="p">[</span><span class="n">training_data_connection</span><span class="p">],</span>
        <span class="n">training_results_reference</span><span class="o">=</span><span class="n">results_connection</span><span class="p">,</span>
        <span class="n">background_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>To run AutoAI experiment with separate holdout data you can use <code class="docutils literal notranslate"><span class="pre">fit()</span></code> method with <code class="docutils literal notranslate"><span class="pre">test_data_references</span></code> parameter. See the example below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit_details</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">training_data_references</span><span class="o">=</span><span class="p">[</span><span class="n">training_data_connection</span><span class="p">],</span>
        <span class="n">test_data_references</span><span class="o">=</span><span class="p">[</span><span class="n">test_data_connection</span><span class="p">],</span>
        <span class="n">training_results_reference</span><span class="o">=</span><span class="n">results_connection</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-run-status-get-run-details">
<h2>Get run status, get run details<a class="headerlink" href="#get-run-status-get-run-details" title="Permalink to this heading">¶</a></h2>
<p>If you use the <code class="docutils literal notranslate"><span class="pre">fit()</span></code> method asynchronously, you can monitor the run/fit details and status, using the following two methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">status</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">get_run_status</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
<span class="s1">&#39;running&#39;</span>

<span class="c1"># OR</span>

<span class="s1">&#39;completed&#39;</span>

<span class="n">run_details</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">get_run_details</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">run_details</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;pipeline&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;href&#39;</span><span class="p">:</span> <span class="s1">&#39;/v4/pipelines/5bfeb4c5-90df-48b8-9e03-ba232d8c0838&#39;</span><span class="p">},</span>
        <span class="s1">&#39;results_reference&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;connection&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">},</span>
                              <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;bucket&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;logs&#39;</span><span class="p">:</span> <span class="s1">&#39;53c8cb7b-c8b5-44aa-8b52-6fde3c588462&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;53c8cb7b-c8b5-44aa-8b52-6fde3c588462/model&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;pipeline&#39;</span><span class="p">:</span> <span class="s1">&#39;./33825fa2-5fca-471a-ab1a-c84820b3e34e/pipeline.json&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;training&#39;</span><span class="p">:</span> <span class="s1">&#39;./33825fa2-5fca-471a-ab1a-c84820b3e34e&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;training_status&#39;</span><span class="p">:</span> <span class="s1">&#39;./33825fa2-5fca-471a-ab1a-c84820b3e34e/training-status.json&#39;</span><span class="p">},</span>
                              <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;connected_asset&#39;</span><span class="p">},</span>
        <span class="s1">&#39;space&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;href&#39;</span><span class="p">:</span> <span class="s1">&#39;/v4/spaces/71ab11ea-bb77-4ae6-b98a-a77f30ade09d&#39;</span><span class="p">},</span>
        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;completed_at&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-02-17T10:46:32.962Z&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;Training job &#39;</span>
                                       <span class="s1">&#39;33825fa2-5fca-471a-ab1a-c84820b3e34e &#39;</span>
                                       <span class="s1">&#39;completed&#39;</span><span class="p">},</span>
                   <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">},</span>
        <span class="s1">&#39;training_data_references&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;connection&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span><span class="p">},</span>
                                      <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;bucket&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span><span class="p">},</span>
                                      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;connected_asset&#39;</span><span class="p">}]},</span>
 <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-02-17T10:44:22.532Z&#39;</span><span class="p">,</span>
              <span class="s1">&#39;guid&#39;</span><span class="p">:</span> <span class="s1">&#39;33825fa2-5fca-471a-ab1a-c84820b3e34e&#39;</span><span class="p">,</span>
              <span class="s1">&#39;href&#39;</span><span class="p">:</span> <span class="s1">&#39;/v4/trainings/33825fa2-5fca-471a-ab1a-c84820b3e34e&#39;</span><span class="p">,</span>
              <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;33825fa2-5fca-471a-ab1a-c84820b3e34e&#39;</span><span class="p">,</span>
              <span class="s1">&#39;modified_at&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-02-17T10:46:32.987Z&#39;</span><span class="p">}}</span>
</pre></div>
</div>
</section>
<section id="get-data-connections">
<h2>Get data connections<a class="headerlink" href="#get-data-connections" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">data_connections</span></code> list contains all training connections that you referenced while calling the <code class="docutils literal notranslate"><span class="pre">fit()</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_connections</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">get_data_connections</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="get-preprocessed-data-connection-joined-data-only">
<h2>Get preprocessed data connection (joined data only)<a class="headerlink" href="#get-preprocessed-data-connection-joined-data-only" title="Permalink to this heading">¶</a></h2>
<p><strong>Warning!</strong> Not supported for IBM Cloud.</p>
<p>The preprocessed_data_connection contains connection to joined training data. You can read joined data using code in below cell.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">get_preprocessed_data_connection</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>It is possible to get a ranking of all the computed pipeline models, sorted based on a scoring metric supplied when configuring the optimizer (<code class="docutils literal notranslate"><span class="pre">scoring</span></code> parameter). The output type is a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> with pipeline names, computation timestamps, machine learning metrics, and the number of enhancements implemented in each of the pipelines.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
               <span class="n">Number</span> <span class="n">of</span> <span class="n">enhancements</span>  <span class="o">...</span>  <span class="n">training_f1</span>
<span class="n">Pipeline</span> <span class="n">Name</span>                          <span class="o">...</span>
<span class="n">Pipeline_4</span>                          <span class="mi">3</span>  <span class="o">...</span>     <span class="mf">0.555556</span>
<span class="n">Pipeline_3</span>                          <span class="mi">2</span>  <span class="o">...</span>     <span class="mf">0.554978</span>
<span class="n">Pipeline_2</span>                          <span class="mi">1</span>  <span class="o">...</span>     <span class="mf">0.503175</span>
<span class="n">Pipeline_1</span>                          <span class="mi">0</span>  <span class="o">...</span>     <span class="mf">0.529928</span>
</pre></div>
</div>
</section>
<section id="get-pipeline-details">
<h2>Get pipeline details<a class="headerlink" href="#get-pipeline-details" title="Permalink to this heading">¶</a></h2>
<p>To see pipeline composition steps and nodes, use the <code class="docutils literal notranslate"><span class="pre">get_pipeline_details()</span></code> method.
If you leave <code class="docutils literal notranslate"><span class="pre">pipeline_name</span></code> empty, the method returns the details of the best computed pipeline.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline_params</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">get_pipeline_details</span><span class="p">(</span><span class="n">pipeline_name</span><span class="o">=</span><span class="s1">&#39;Pipeline_1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pipeline_params</span><span class="p">)</span>
<span class="p">{</span>
    <span class="s1">&#39;composition_steps&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;TrainingDataset_full_199_16&#39;</span><span class="p">,</span> <span class="s1">&#39;Split_TrainingHoldout&#39;</span><span class="p">,</span>
        <span class="s1">&#39;TrainingDataset_full_179_16&#39;</span><span class="p">,</span> <span class="s1">&#39;Preprocessor_default&#39;</span><span class="p">,</span> <span class="s1">&#39;DAUB&#39;</span>
        <span class="p">],</span>
    <span class="s1">&#39;pipeline_nodes&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;PreprocessingTransformer&#39;</span><span class="p">,</span> <span class="s1">&#39;LogisticRegressionEstimator&#39;</span>
        <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="get-pipeline">
<h2>Get pipeline<a class="headerlink" href="#get-pipeline" title="Permalink to this heading">¶</a></h2>
<p>Use the <code class="docutils literal notranslate"><span class="pre">get_pipeline()</span></code> method to load a specific pipeline. By default, <code class="docutils literal notranslate"><span class="pre">get_pipeline()</span></code> returns a lale pipeline. For information on lale pipelines, refer to (<a class="reference external" href="https://github.com/ibm/lale">https://github.com/ibm/lale</a>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">get_pipeline</span><span class="p">(</span><span class="n">pipeline_name</span><span class="o">=</span><span class="s1">&#39;Pipeline_4&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="s1">&#39;lale.operators.TrainablePipeline&#39;</span>
</pre></div>
</div>
<p>You can also load a pipeline as a scikit learn (sklearn) pipeline model type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_optimizer</span><span class="o">.</span><span class="n">get_pipeline</span><span class="p">(</span><span class="n">pipeline_name</span><span class="o">=</span><span class="s1">&#39;Pipeline_4&#39;</span><span class="p">,</span> <span class="n">astype</span><span class="o">=</span><span class="n">AutoAI</span><span class="o">.</span><span class="n">PipelineTypes</span><span class="o">.</span><span class="n">SKLEARN</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
<span class="c1"># &lt;class &#39;sklearn.pipeline.Pipeline&#39;&gt;</span>
</pre></div>
</div>
</section>
<section id="working-with-deployments">
<h2>Working with deployments<a class="headerlink" href="#working-with-deployments" title="Permalink to this heading">¶</a></h2>
<p>This section describes classes that enable you to work with Watson Machine Learning deployments.</p>
</section>
<section id="web-service">
<span id="working-with-web-service"></span><h2>Web Service<a class="headerlink" href="#web-service" title="Permalink to this heading">¶</a></h2>
<p>Web Service is an online type of deployment. It allows you to upload and deploy your model, to score it through an online web service. You must pass the location where the training was performed (<code class="docutils literal notranslate"><span class="pre">source_space_id</span></code> or <code class="docutils literal notranslate"><span class="pre">source_project_id</span></code>). The model can be deployed to any space or project (<code class="docutils literal notranslate"><span class="pre">target_space_id</span></code> or <code class="docutils literal notranslate"><span class="pre">target_project_id</span></code>).</p>
<p><strong>Note:</strong> WebService supports only the AutoAI deployment type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ibm_watson_machine_learning.deployment</span> <span class="kn">import</span> <span class="n">WebService</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">WebService</span><span class="p">(</span><span class="n">wml_credentials</span><span class="p">,</span>
     <span class="n">source_space_id</span><span class="o">=</span><span class="s1">&#39;76g53e0-0b32-4a0e-9152-3d50324855ddb&#39;</span><span class="p">,</span>
     <span class="n">target_space_id</span><span class="o">=</span><span class="s1">&#39;1234abc1234abc1234abc1234abc1234abcd&#39;</span><span class="p">)</span>
 <span class="p">)</span>

<span class="n">service</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
       <span class="n">experiment_run_id</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
       <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
       <span class="n">deployment_name</span><span class="o">=</span><span class="s1">&#39;My new deployment&#39;</span>
   <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="batch">
<span id="working-with-batch"></span><h2>Batch<a class="headerlink" href="#batch" title="Permalink to this heading">¶</a></h2>
<p>Batch manages the batch type of deployment. It allows you to upload and deploy a model and
run a batch deployment job. As in Web Service, you must pass the location where
the training was performed (<code class="docutils literal notranslate"><span class="pre">source_space_id</span></code> or <code class="docutils literal notranslate"><span class="pre">source_project_id</span></code>).
The model can be deployed to any space or project (<code class="docutils literal notranslate"><span class="pre">target_space_id</span></code> or <code class="docutils literal notranslate"><span class="pre">target_project_id</span></code>).</p>
<p>The input data can be provided as a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>, a data-asset, or a Cloud Object Storage (COS) file.</p>
<p><strong>Note:</strong> WebService supports only the AutoAI deployment type.</p>
<p>Example of a batch deployment creation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ibm_watson_machine_learning.deployment</span> <span class="kn">import</span> <span class="n">Batch</span>

<span class="n">service_batch</span> <span class="o">=</span> <span class="n">Batch</span><span class="p">(</span><span class="n">wml_credentials</span><span class="p">,</span> <span class="n">source_space_id</span><span class="o">=</span><span class="s1">&#39;76g53e0-0b32-4a0e-9152-3d50324855ddb&#39;</span><span class="p">)</span>
<span class="n">service_batch</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">experiment_run_id</span><span class="o">=</span><span class="s2">&quot;6ce62a02-3e41-4d11-89d1-484c2deaed75&quot;</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;Pipeline_4&quot;</span><span class="p">,</span>
        <span class="n">deployment_name</span><span class="o">=</span><span class="s1">&#39;Batch deployment&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example of a batch job creation with inline data as <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scoring_params</span> <span class="o">=</span> <span class="n">service_batch</span><span class="o">.</span><span class="n">run_job</span><span class="p">(</span>
            <span class="n">payload</span><span class="o">=</span><span class="n">test_X_df</span><span class="p">,</span>
            <span class="n">background_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Example of batch job creation with a COS object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ibm_watson_machine_learning.helpers.connections</span> <span class="kn">import</span> <span class="n">S3Location</span><span class="p">,</span> <span class="n">DataConnection</span>

<span class="n">connection_details</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
    <span class="n">client</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">ConfigurationMetaNames</span><span class="o">.</span><span class="n">NAME</span><span class="p">:</span> <span class="s2">&quot;Connection to COS&quot;</span><span class="p">,</span>
    <span class="n">client</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">ConfigurationMetaNames</span><span class="o">.</span><span class="n">DATASOURCE_TYPE</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">get_datasource_type_uid_by_name</span><span class="p">(</span><span class="s1">&#39;bluemixcloudobjectstorage&#39;</span><span class="p">),</span>
    <span class="n">client</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">ConfigurationMetaNames</span><span class="o">.</span><span class="n">PROPERTIES</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;bucket&#39;</span><span class="p">:</span> <span class="s1">&#39;bucket_name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;access_key&#39;</span><span class="p">:</span> <span class="s1">&#39;COS access key id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;secret_key&#39;</span><span class="p">:</span> <span class="s1">&#39;COS secret access key&#39;</span>
        <span class="s1">&#39;iam_url&#39;</span><span class="p">:</span> <span class="s1">&#39;COS iam url&#39;</span><span class="p">,</span>
        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;COS endpoint url&#39;</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="n">connection_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">get_uid</span><span class="p">(</span><span class="n">connection_details</span><span class="p">)</span>

<span class="n">payload_reference</span> <span class="o">=</span> <span class="n">DataConnection</span><span class="p">(</span>
        <span class="n">connection_asset_id</span><span class="o">=</span><span class="n">connection_id</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="n">S3Location</span><span class="p">(</span><span class="n">bucket</span><span class="o">=</span><span class="s1">&#39;bucket_name&#39;</span><span class="p">,</span>   <span class="c1"># note: COS bucket name where deployment payload dataset is located</span>
                            <span class="n">path</span><span class="o">=</span><span class="s1">&#39;my_path&#39;</span>  <span class="c1"># note: path within bucket where your deployment payload dataset is located</span>
                            <span class="p">)</span>
    <span class="p">)</span>

<span class="n">results_reference</span> <span class="o">=</span> <span class="n">DataConnection</span><span class="p">(</span>
        <span class="n">connection_asset_id</span><span class="o">=</span><span class="n">connection_id</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="n">S3Location</span><span class="p">(</span><span class="n">bucket</span><span class="o">=</span><span class="s1">&#39;bucket_name&#39;</span><span class="p">,</span>   <span class="c1"># note: COS bucket name where deployment output should be located</span>
                            <span class="n">path</span><span class="o">=</span><span class="s1">&#39;my_path_where_output_will_be_saved&#39;</span>  <span class="c1"># note: path within bucket where your deployment output should be located</span>
                            <span class="p">)</span>
    <span class="p">)</span>
<span class="n">payload_reference</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;local_path_to_the_batch_payload_csv_file&quot;</span><span class="p">,</span> <span class="n">remote_name</span><span class="o">=</span><span class="s2">&quot;batch_payload_location.csv&quot;</span><span class="p">])</span>

<span class="n">scoring_params</span> <span class="o">=</span> <span class="n">service_batch</span><span class="o">.</span><span class="n">run_job</span><span class="p">(</span>
    <span class="n">payload</span><span class="o">=</span><span class="p">[</span><span class="n">payload_reference</span><span class="p">],</span>
    <span class="n">output_data_reference</span><span class="o">=</span><span class="n">results_reference</span><span class="p">,</span>
    <span class="n">background_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>   <span class="c1"># If background_mode is False, then synchronous mode is started. Otherwise job status need to be monitored.</span>
</pre></div>
</div>
<p>Example of a batch job creation with a data-asset object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ibm_watson_machine_learning.helpers.connections</span> <span class="kn">import</span> <span class="n">DataConnection</span><span class="p">,</span> <span class="n">CloudAssetLocation</span><span class="p">,</span> <span class="n">DeploymentOutputAssetLocation</span>

<span class="n">payload_reference</span> <span class="o">=</span> <span class="n">DataConnection</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">CloudAssetLocation</span><span class="p">(</span><span class="n">asset_id</span><span class="o">=</span><span class="n">asset_id</span><span class="p">))</span>
<span class="n">results_reference</span> <span class="o">=</span> <span class="n">DataConnection</span><span class="p">(</span>
        <span class="n">location</span><span class="o">=</span><span class="n">DeploymentOutputAssetLocation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;batch_output_file_name.csv&quot;</span><span class="p">))</span>

    <span class="n">scoring_params</span> <span class="o">=</span> <span class="n">service_batch</span><span class="o">.</span><span class="n">run_job</span><span class="p">(</span>
        <span class="n">payload</span><span class="o">=</span><span class="p">[</span><span class="n">payload_reference</span><span class="p">],</span>
        <span class="n">output_data_reference</span><span class="o">=</span><span class="n">results_reference</span><span class="p">,</span>
        <span class="n">background_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2018-2023, IBM.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/autoai_working_with_class_and_optimizer.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>